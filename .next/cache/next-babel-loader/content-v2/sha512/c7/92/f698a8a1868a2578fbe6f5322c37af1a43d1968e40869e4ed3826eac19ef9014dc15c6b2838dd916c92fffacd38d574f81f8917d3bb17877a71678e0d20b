{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/raphael/github/benevolent-crud/src/pages/p/[id].tsx\";\nimport _JSXStyle from \"styled-jsx/style\";\nimport React from \"react\";\nimport ReactMarkdown from \"react-markdown\";\nimport Layout from \"../../components/Layout\";\nimport Router from \"next/router\";\nimport prisma from '../../../lib/prisma';\nimport { useSession } from \"next-auth/client\";\nimport styles from '../../styles/Draft.module.css';\nexport const getServerSideProps = async ({\n  params\n}) => {\n  const post = await prisma.post.findUnique({\n    where: {\n      id: Number(params === null || params === void 0 ? void 0 : params.id) || -1\n    },\n    include: {\n      author: {\n        select: {\n          name: true,\n          email: true\n        }\n      }\n    }\n  });\n  return {\n    props: post\n  };\n};\n\nasync function publishPost(id) {\n  await fetch(`http://localhost:3000/api/publish/${id}`, {\n    method: \"PUT\"\n  });\n  await Router.push(\"/\");\n}\n\nasync function deletePost(id) {\n  await fetch(`http://localhost:3000/api/post/${id}`, {\n    method: \"DELETE\"\n  });\n  await Router.push(\"/\");\n} //const Post: React.FC<PostProps> = (props) => {\n\n\nfunction Post(props) {\n  var _session$user, _props$author, _props$author2;\n\n  const [session, loading] = useSession();\n\n  if (loading) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: \"Autenticando ...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 45,\n      columnNumber: 12\n    }, this);\n  }\n\n  const userHasValidSession = Boolean(session);\n  const postBelongsToUser = (session === null || session === void 0 ? void 0 : (_session$user = session.user) === null || _session$user === void 0 ? void 0 : _session$user.email) === ((_props$author = props.author) === null || _props$author === void 0 ? void 0 : _props$author.email);\n  let title = props.title;\n\n  if (!props.published) {\n    title = `${title} (Rascunho)`;\n  }\n\n  return /*#__PURE__*/_jsxDEV(Layout, {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"jsx-2047419819\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"jsx-2047419819\",\n        children: title\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 57,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"jsx-2047419819\",\n        children: [\"Escrito por \", (props === null || props === void 0 ? void 0 : (_props$author2 = props.author) === null || _props$author2 === void 0 ? void 0 : _props$author2.name) || \"Unknown author\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 58,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(ReactMarkdown, {\n        source: props.content\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 59,\n        columnNumber: 9\n      }, this), !props.published && userHasValidSession && postBelongsToUser && /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => publishPost(props.id),\n        className: \"jsx-2047419819\" + \" \" + (styles.submit || \"\"),\n        children: \"Publicar\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 61,\n        columnNumber: 11\n      }, this), userHasValidSession && postBelongsToUser && /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => deletePost(props.id),\n        className: \"jsx-2047419819\" + \" \" + (styles.submit || \"\"),\n        children: \"Apagar\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 69,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 56,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(_JSXStyle, {\n      id: \"2047419819\",\n      children: \".page.jsx-2047419819{background:white;padding:2rem;}.actions.jsx-2047419819{margin-top:2rem;}button.jsx-2047419819+button.jsx-2047419819{margin-left:1rem;}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9yYXBoYWVsL2dpdGh1Yi9iZW5ldm9sZW50LWNydWQvc3JjL3BhZ2VzL3AvW2lkXS50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBNEVrQixBQUc0QixBQUtELEFBTUMsZ0JBTG5CLENBTGUsQUFXZixhQVZBIiwiZmlsZSI6Ii9Vc2Vycy9yYXBoYWVsL2dpdGh1Yi9iZW5ldm9sZW50LWNydWQvc3JjL3BhZ2VzL3AvW2lkXS50c3giLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QgZnJvbSBcInJlYWN0XCI7XG5pbXBvcnQgeyBHZXRTZXJ2ZXJTaWRlUHJvcHMgfSBmcm9tIFwibmV4dFwiO1xuaW1wb3J0IFJlYWN0TWFya2Rvd24gZnJvbSBcInJlYWN0LW1hcmtkb3duXCI7XG5pbXBvcnQgTGF5b3V0IGZyb20gXCIuLi8uLi9jb21wb25lbnRzL0xheW91dFwiO1xuaW1wb3J0IFJvdXRlciBmcm9tIFwibmV4dC9yb3V0ZXJcIjtcbmltcG9ydCB7IFBvc3RQcm9wcyB9IGZyb20gXCIuLi8uLi9jb21wb25lbnRzL1Bvc3RcIjtcbmltcG9ydCBwcmlzbWEgZnJvbSAnLi4vLi4vLi4vbGliL3ByaXNtYSc7XG5pbXBvcnQgeyB1c2VTZXNzaW9uIH0gZnJvbSBcIm5leHQtYXV0aC9jbGllbnRcIjtcbmltcG9ydCBzdHlsZXMgZnJvbSAnLi4vLi4vc3R5bGVzL0RyYWZ0Lm1vZHVsZS5jc3MnO1xuXG5leHBvcnQgY29uc3QgZ2V0U2VydmVyU2lkZVByb3BzOiBHZXRTZXJ2ZXJTaWRlUHJvcHMgPSBhc3luYyAoeyBwYXJhbXMgfSkgPT4ge1xuICBjb25zdCBwb3N0ID0gYXdhaXQgcHJpc21hLnBvc3QuZmluZFVuaXF1ZSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIGlkOiBOdW1iZXIocGFyYW1zPy5pZCkgfHwgLTEsXG4gICAgfSxcbiAgICBpbmNsdWRlOiB7XG4gICAgICBhdXRob3I6IHtcbiAgICAgICAgc2VsZWN0OiB7IG5hbWU6IHRydWUsIGVtYWlsOiB0cnVlIH0sXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuICByZXR1cm4ge1xuICAgIHByb3BzOiBwb3N0LFxuICB9O1xufTtcblxuYXN5bmMgZnVuY3Rpb24gcHVibGlzaFBvc3QoaWQ6IG51bWJlcik6IFByb21pc2U8dm9pZD4ge1xuICBhd2FpdCBmZXRjaChgaHR0cDovL2xvY2FsaG9zdDozMDAwL2FwaS9wdWJsaXNoLyR7aWR9YCwge1xuICAgIG1ldGhvZDogXCJQVVRcIixcbiAgfSk7XG4gIGF3YWl0IFJvdXRlci5wdXNoKFwiL1wiKVxufVxuXG5hc3luYyBmdW5jdGlvbiBkZWxldGVQb3N0KGlkOiBudW1iZXIpOiBQcm9taXNlPHZvaWQ+IHtcbiAgYXdhaXQgZmV0Y2goYGh0dHA6Ly9sb2NhbGhvc3Q6MzAwMC9hcGkvcG9zdC8ke2lkfWAsIHtcbiAgICBtZXRob2Q6IFwiREVMRVRFXCIsXG4gIH0pO1xuICBhd2FpdCBSb3V0ZXIucHVzaChcIi9cIilcbn1cblxuLy9jb25zdCBQb3N0OiBSZWFjdC5GQzxQb3N0UHJvcHM+ID0gKHByb3BzKSA9PiB7XG5mdW5jdGlvbiBQb3N0KHByb3BzOiBQb3N0UHJvcHMpIHtcbiAgY29uc3QgW3Nlc3Npb24sIGxvYWRpbmddID0gdXNlU2Vzc2lvbigpO1xuICBpZiAobG9hZGluZykge1xuICAgIHJldHVybiA8ZGl2PkF1dGVudGljYW5kbyAuLi48L2Rpdj47XG4gIH1cbiAgY29uc3QgdXNlckhhc1ZhbGlkU2Vzc2lvbiA9IEJvb2xlYW4oc2Vzc2lvbik7XG4gIGNvbnN0IHBvc3RCZWxvbmdzVG9Vc2VyID0gc2Vzc2lvbj8udXNlcj8uZW1haWwgPT09IHByb3BzLmF1dGhvcj8uZW1haWw7XG4gIGxldCB0aXRsZSA9IHByb3BzLnRpdGxlO1xuICBpZiAoIXByb3BzLnB1Ymxpc2hlZCkge1xuICAgIHRpdGxlID0gYCR7dGl0bGV9IChSYXNjdW5obylgO1xuICB9XG5cbiAgcmV0dXJuIChcbiAgICA8TGF5b3V0PlxuICAgICAgPGRpdj5cbiAgICAgICAgPGgyPnt0aXRsZX08L2gyPlxuICAgICAgICA8cD5Fc2NyaXRvIHBvciB7cHJvcHM/LmF1dGhvcj8ubmFtZSB8fCBcIlVua25vd24gYXV0aG9yXCJ9PC9wPlxuICAgICAgICA8UmVhY3RNYXJrZG93biBzb3VyY2U9e3Byb3BzLmNvbnRlbnR9IC8+XG4gICAgICAgIHshcHJvcHMucHVibGlzaGVkICYmIHVzZXJIYXNWYWxpZFNlc3Npb24gJiYgcG9zdEJlbG9uZ3NUb1VzZXIgJiYgKFxuICAgICAgICAgIDxidXR0b24gXG4gICAgICAgICAgICBjbGFzc05hbWU9e3N0eWxlcy5zdWJtaXR9ICBcbiAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHB1Ymxpc2hQb3N0KHByb3BzLmlkKX0gICAgICAgICAgICBcbiAgICAgICAgICA+XG4gICAgICAgICAgICBQdWJsaWNhclxuICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICApfVxuICAgICAgICB7dXNlckhhc1ZhbGlkU2Vzc2lvbiAmJiBwb3N0QmVsb25nc1RvVXNlciAmJiAoXG4gICAgICAgICAgPGJ1dHRvbiBcbiAgICAgICAgICAgIGNsYXNzTmFtZT17c3R5bGVzLnN1Ym1pdH0gIFxuICAgICAgICAgICAgb25DbGljaz17KCkgPT4gZGVsZXRlUG9zdChwcm9wcy5pZCl9XG4gICAgICAgICAgPlxuICAgICAgICAgICAgQXBhZ2FyXG4gICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICl9XG4gICAgICA8L2Rpdj5cbiAgICAgIDxzdHlsZSBqc3g+e2BcbiAgICAgICAgLnBhZ2Uge1xuICAgICAgICAgIGJhY2tncm91bmQ6IHdoaXRlO1xuICAgICAgICAgIHBhZGRpbmc6IDJyZW07XG4gICAgICAgIH1cblxuICAgICAgICAuYWN0aW9ucyB7XG4gICAgICAgICAgbWFyZ2luLXRvcDogMnJlbTtcbiAgICAgICAgfVxuXG4gICAgICAgIFxuXG4gICAgICAgIGJ1dHRvbiArIGJ1dHRvbiB7XG4gICAgICAgICAgbWFyZ2luLWxlZnQ6IDFyZW07XG4gICAgICAgIH1cbiAgICAgIGB9PC9zdHlsZT5cbiAgICA8L0xheW91dD5cbiAgKTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IFBvc3Q7XG4iXX0= */\\n/*@ sourceURL=/Users/raphael/github/benevolent-crud/src/pages/p/[id].tsx */\"\n    }, void 0, false, void 0, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 55,\n    columnNumber: 5\n  }, this);\n}\n\n;\nexport default Post;","map":{"version":3,"sources":["/Users/raphael/github/benevolent-crud/src/pages/p/[id].tsx"],"names":["React","ReactMarkdown","Layout","Router","prisma","useSession","styles","getServerSideProps","params","post","findUnique","where","id","Number","include","author","select","name","email","props","publishPost","fetch","method","push","deletePost","Post","session","loading","userHasValidSession","Boolean","postBelongsToUser","user","title","published","content","submit"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport { GetServerSideProps } from \"next\";\nimport ReactMarkdown from \"react-markdown\";\nimport Layout from \"../../components/Layout\";\nimport Router from \"next/router\";\nimport { PostProps } from \"../../components/Post\";\nimport prisma from '../../../lib/prisma';\nimport { useSession } from \"next-auth/client\";\nimport styles from '../../styles/Draft.module.css';\n\nexport const getServerSideProps: GetServerSideProps = async ({ params }) => {\n  const post = await prisma.post.findUnique({\n    where: {\n      id: Number(params?.id) || -1,\n    },\n    include: {\n      author: {\n        select: { name: true, email: true },\n      },\n    },\n  });\n  return {\n    props: post,\n  };\n};\n\nasync function publishPost(id: number): Promise<void> {\n  await fetch(`http://localhost:3000/api/publish/${id}`, {\n    method: \"PUT\",\n  });\n  await Router.push(\"/\")\n}\n\nasync function deletePost(id: number): Promise<void> {\n  await fetch(`http://localhost:3000/api/post/${id}`, {\n    method: \"DELETE\",\n  });\n  await Router.push(\"/\")\n}\n\n//const Post: React.FC<PostProps> = (props) => {\nfunction Post(props: PostProps) {\n  const [session, loading] = useSession();\n  if (loading) {\n    return <div>Autenticando ...</div>;\n  }\n  const userHasValidSession = Boolean(session);\n  const postBelongsToUser = session?.user?.email === props.author?.email;\n  let title = props.title;\n  if (!props.published) {\n    title = `${title} (Rascunho)`;\n  }\n\n  return (\n    <Layout>\n      <div>\n        <h2>{title}</h2>\n        <p>Escrito por {props?.author?.name || \"Unknown author\"}</p>\n        <ReactMarkdown source={props.content} />\n        {!props.published && userHasValidSession && postBelongsToUser && (\n          <button \n            className={styles.submit}  \n            onClick={() => publishPost(props.id)}            \n          >\n            Publicar\n          </button>\n        )}\n        {userHasValidSession && postBelongsToUser && (\n          <button \n            className={styles.submit}  \n            onClick={() => deletePost(props.id)}\n          >\n            Apagar\n          </button>\n        )}\n      </div>\n      <style jsx>{`\n        .page {\n          background: white;\n          padding: 2rem;\n        }\n\n        .actions {\n          margin-top: 2rem;\n        }\n\n        \n\n        button + button {\n          margin-left: 1rem;\n        }\n      `}</style>\n    </Layout>\n  );\n};\n\nexport default Post;\n"]},"metadata":{},"sourceType":"module"}